<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="900" height="520" viewBox="0 0 900 520"
     xmlns="http://www.w3.org/2000/svg">

  <!-- Background -->
  <rect x="0" y="0" width="900" height="520" fill="#ffffff" stroke="#cccccc" />

  <!-- Title -->
  <text x="450" y="40" text-anchor="middle" font-family="sans-serif" font-size="20" font-weight="bold">
    RUNE Protocol Architecture
  </text>

  <!-- Orchestrator -->
  <rect x="330" y="70" width="240" height="60" rx="8" ry="8"
        fill="#e8f1ff" stroke="#5878c2" stroke-width="1.5" />
  <text x="450" y="105" text-anchor="middle" font-family="sans-serif" font-size="14" font-weight="bold">
    RUNE Orchestrator / Core
  </text>

  <!-- Envelope block -->
  <rect x="170" y="160" width="560" height="140" rx="10" ry="10"
        fill="#f7f7f7" stroke="#999999" stroke-width="1.5" />
  <text x="450" y="185" text-anchor="middle" font-family="sans-serif" font-size="14" font-weight="bold">
    Message Envelope (RCS)
  </text>

  <!-- Envelope inner labels -->
  <!-- Message metadata -->
  <rect x="190" y="200" width="160" height="80" rx="6" ry="6"
        fill="#fff" stroke="#bbbbbb" stroke-width="1" />
  <text x="270" y="228" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold">
    message_metadata
  </text>
  <text x="270" y="246" text-anchor="middle" font-family="sans-serif" font-size="11">
    trace_id, action, node
  </text>

  <!-- Routing & Observability -->
  <rect x="370" y="200" width="160" height="80" rx="6" ry="6"
        fill="#fff" stroke="#bbbbbb" stroke-width="1" />
  <text x="450" y="224" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold">
    routing &amp; observability
  </text>
  <text x="450" y="244" text-anchor="middle" font-family="sans-serif" font-size="11">
    route, timing, spans, etc.
  </text>

  <!-- Payload -->
  <rect x="550" y="200" width="160" height="80" rx="6" ry="6"
        fill="#fff" stroke="#bbbbbb" stroke-width="1" />
  <text x="630" y="224" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold">
    payload
  </text>
  <text x="630" y="244" text-anchor="middle" font-family="sans-serif" font-size="11">
    data, result, error
  </text>

  <!-- Arrow from orchestrator to envelope -->
  <line x1="450" y1="130" x2="450" y2="160" stroke="#444" stroke-width="1.5" marker-end="url(#arrow)" />

  <!-- BPCS plugin I/O zone -->
  <rect x="170" y="330" width="560" height="150" rx="10" ry="10"
        fill="#f5fbf5" stroke="#7ca97c" stroke-width="1.5" />
  <text x="450" y="355" text-anchor="middle" font-family="sans-serif" font-size="14" font-weight="bold">
    Plugin Interface (BPCS)
  </text>

  <!-- Input parameters box -->
  <rect x="190" y="370" width="200" height="80" rx="6" ry="6"
        fill="#ffffff" stroke="#7ca97c" stroke-width="1" />
  <text x="290" y="395" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold">
    Input to Plugin
  </text>
  <text x="290" y="413" text-anchor="middle" font-family="sans-serif" font-size="11">
    payload.data.input_parameters
  </text>
  <text x="290" y="431" text-anchor="middle" font-family="sans-serif" font-size="11">
    (rune_param / rune_param_json)
  </text>

  <!-- Output box -->
  <rect x="510" y="370" width="200" height="80" rx="6" ry="6"
        fill="#ffffff" stroke="#7ca97c" stroke-width="1" />
  <text x="610" y="395" text-anchor="middle" font-family="sans-serif" font-size="12" font-weight="bold">
    Output from Plugin
  </text>
  <text x="610" y="413" text-anchor="middle" font-family="sans-serif" font-size="11">
    payload.output_data or error
  </text>
  <text x="610" y="431" text-anchor="middle" font-family="sans-serif" font-size="11">
    (rune_ok / rune_error / rune_finish)
  </text>

  <!-- Plugin box -->
  <rect x="350" y="390" width="200" height="80" rx="10" ry="10"
        fill="#fffbe6" stroke="#c2a858" stroke-width="1.5" />
  <text x="450" y="420" text-anchor="middle" font-family="sans-serif" font-size="13" font-weight="bold">
    Plugin / Module
  </text>
  <text x="450" y="438" text-anchor="middle" font-family="sans-serif" font-size="11">
    Bash plugin using rune_bpcs.sh
  </text>

  <!-- Arrows between envelope and plugin zone -->
  <line x1="450" y1="300" x2="450" y2="330" stroke="#444" stroke-width="1.5" marker-end="url(#arrow)" />
  <line x1="290" y1="330" x2="290" y2="370" stroke="#444" stroke-width="1.2" marker-end="url(#arrow)" />
  <line x1="610" y1="330" x2="610" y2="370" stroke="#444" stroke-width="1.2" marker-end="url(#arrow)" />

  <!-- Arrows between input box, plugin, and output box -->
  <line x1="390" y1="410" x2="350" y2="410" stroke="#444" stroke-width="1.2" marker-end="url(#arrow)" />
  <line x1="550" y1="430" x2="510" y2="430" stroke="#444" stroke-width="1.2" marker-end="url(#arrow)" />

  <!-- Legend -->
  <rect x="25" y="430" width="230" height="70" rx="8" ry="8"
        fill="#ffffff" stroke="#cccccc" stroke-width="1" />
  <text x="40" y="450" font-family="sans-serif" font-size="11" font-weight="bold">
    Legend
  </text>
  <rect x="40" y="460" width="14" height="10" fill="#f7f7f7" stroke="#999999" stroke-width="1" />
  <text x="60" y="468" font-family="sans-serif" font-size="11">RCS message envelope</text>
  <rect x="40" y="476" width="14" height="10" fill="#f5fbf5" stroke="#7ca97c" stroke-width="1" />
  <text x="60" y="484" font-family="sans-serif" font-size="11">BPCS plugin interface</text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5"
            markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#444" />
    </marker>
  </defs>

</svg>
